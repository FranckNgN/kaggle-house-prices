#!/usr/bin/env python
# coding: utf-8
"""
Example model script with integrated sanity checks.
Copy this pattern to add validation to your model scripts.
"""

import os
import numpy as np
import pandas as pd
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error
from config_local import local_config
from config_local import model_config
from utils.data import load_sample_submission

# Import validation wrappers (they automatically check if validation is enabled)
from utils.model_wrapper import (
    validate_inputs_wrapper,
    validate_predictions_wrapper,
    validate_submission_wrapper
)


if __name__ == "__main__":
    # Load data
    train = pd.read_csv(local_config.TRAIN_PROCESS7_CSV)
    test = pd.read_csv(local_config.TEST_PROCESS7_CSV)

    y = train['logSP']
    X = train.drop(columns=['logSP'])
    X_test = test

    # ============================================================
    # VALIDATION CHECK 1: Validate inputs before training
    # ============================================================
    validate_inputs_wrapper(X, y, X_test, "LinearRegression")

    # Train model
    from sklearn.linear_model import Ridge
    model = Ridge(alpha=100.0)
    model.fit(X, y)

    # Make predictions
    pred_test_log = model.predict(X_test)
    
    # ============================================================
    # VALIDATION CHECK 2: Validate predictions
    # ============================================================
    validate_predictions_wrapper(pred_test_log, "LinearRegression", target_is_log=True)

    # Transform to real scale
    pred_test_real = np.expm1(pred_test_log)

    # Create submission
    cfg = model_config.LINEAR_REGRESSION
    submission = load_sample_submission()
    submission["SalePrice"] = pred_test_real

    # ============================================================
    # VALIDATION CHECK 3: Validate submission format
    # ============================================================
    validate_submission_wrapper(submission, len(X_test), "LinearRegression")

    # Save submission
    out_path = local_config.get_model_submission_path(cfg["submission_name"], cfg["submission_filename"])
    submission.to_csv(out_path, index=False)
    print(f"Submission saved -> {out_path}")

